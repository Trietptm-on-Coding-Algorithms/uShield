# Extended Exploitation Test (EET): Installation Guide

----------

# Intro

The Extended Exploitation Test (EET) is designed to include vulnerable applications compiled with modern exploit mitigations (meeting our minimum security baseline) which offer:

* A minimal (but representative for our target environment) gadget surface to attackers so that successful exploitation indicates exploitation against larger binaries is likely to be successful as well.

* Vulnerabilities that are as simple (under imposed minimum security baseline constraints) to exploit as possible so that the inability to craft a successful exploit against these types of vulnerabilities indicates more complicated vulnerability scenarios are unlikely to be successfully exploitable either.

* A simple instance of every relevant vulnerability class to indicate (un)exploitability across vulnerability classes rather than against a single class.

# Pre-Reqs

## Distro

Follow the distro setup steps in the environment setup guide.

## xinetd

Install xinetd:

```bash
sudo apt-get install xinetd
```

## ASLR

Make sure ASLR is enabled on the host:

```bash
sudo su
echo 2 > /proc/sys/kernel/randomize_va_space
```

# Installing the EET

Create a directory for the EET: `mkdir /home/pi/eet` and place the EET sources from the [vuln_apps](vuln_apps) directory in this directory. Compile them using the compiler instruction lines at the top of the source-codes, eg.: `gcc -Bdynamic -fstack-protector-all -Wformat -Wformat-security -Wconversion -Wsign-conversion -Wl,-z,relro,-z,now -o stack_buffer_overflow_1 stack_buffer_overflow_1.c`. Place the xinetd config files from the [xinetd_config](xinetd_config) directory in `/etc/xinetd.d/` and make sure to add them to `/etc/services`:

```bash
# Local services

stackbof1       1337/tcp
stackbof2       1338/tcp
uaf             1339/tcp
heapbof         1340/tcp
fms             1341/tcp
```

Restart xinetd: `sudo service xinetd restart` and make sure the services work: `nc localhost 1337`.

# Running the EET

On a different machine place the exploits from the [exploits](exploits) directory in your working directory. Make sure python 2.7 is installed and install [pwntools](http://pwntools.readthedocs.org/en/2.1.3/): `sudo pip install pwntools`. Change the target ip address in the exploits to the ip address of your raspberry pi and run the exploits, eg. `python uaf_exploit.py`.

For example exploiting the `use_after_free` application using the provided exploit looks as follows:

```bash
$ python uaf_exploit.py 
[+] Opening connection to 192.168.0.102 on port 1339: Done
[+] Got stackpointer: [beffeae8]
[+] Got stack cookie: [c31de100]
[+] Got libc base: [b6e79000]
[+] Got heap pointer: [22008]
[*] Building ROP chain...
[*] Sending exploit payload...
[*] Switching to interactive mode
$ id
uid=1000(pi) gid=1000(pi) groups=1000(pi)
$ uname -a
Linux raspberrypi 4.1.17+ #838 Tue Feb 9 12:57:10 GMT 2016 armv6l GNU/Linux
```